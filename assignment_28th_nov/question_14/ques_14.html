<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Todo App</title>

    <style>
        .completed {
            text-decoration: line-through;
            color: gray;
        }
        .task {
            margin: 5px 0;
        }
        button {
            margin-left: 8px;
        }
    </style>
</head>
<body>

    <input id="taskInput" placeholder="Add task here"> 
    <button onclick="addTask()">Add Task</button>

    <br><br>

    <input id="searchBar" placeholder="Search tasks..." oninput="searchTasks()">

    <h3>Todo List</h3>
    <div id="todoList"></div>

    <script>

        // Load tasks from storage on page load
        window.onload = function () {
            loadTasks();
        };

        function getStoredTasks() {
            return JSON.parse(localStorage.getItem("tasks")) || [];
        }

        function saveTasks(tasks) {
            localStorage.setItem("tasks", JSON.stringify(tasks));
        }

        function loadTasks() {
            const tasks = getStoredTasks();
            const list = document.getElementById("todoList");
            list.innerHTML = ""; // clear UI

            tasks.forEach(task => displayTask(task));
        }

        function addTask() {
            const input = document.getElementById("taskInput");
            const text = input.value.trim();

            if (text === "") {
                alert("Please enter a task.");
                return;
            }

            const task = {
                id: Date.now(),
                text: text,
                completed: false
            };

            const tasks = getStoredTasks();
            tasks.push(task);
            saveTasks(tasks);

            displayTask(task);
            input.value = "";
        }

        function toggleTask(id) {
            let tasks = getStoredTasks();
            tasks = tasks.map(task => {
                if (task.id === id) {
                    task.completed = !task.completed;
                }
                return task;
            });

            saveTasks(tasks);
            loadTasks();
        }

        function deleteTask(id) {
            let tasks = getStoredTasks();
            tasks = tasks.filter(task => task.id !== id);
            saveTasks(tasks);
            loadTasks();
        }

        function displayTask(task) {
            const list = document.getElementById("todoList");

            const div = document.createElement("div");
            div.className = "task";

            const textSpan = document.createElement("span");
            textSpan.innerText = task.text;
            if (task.completed) textSpan.classList.add("completed");

            const toggleBtn = document.createElement("button");
            toggleBtn.innerText = task.completed ? "Undo" : "Complete";
            toggleBtn.onclick = () => toggleTask(task.id);

            const deleteBtn = document.createElement("button");
            deleteBtn.innerText = "Delete";
            deleteBtn.onclick = () => deleteTask(task.id);

            div.appendChild(textSpan);
            div.appendChild(toggleBtn);
            div.appendChild(deleteBtn);

            list.appendChild(div);
        }

        function searchTasks() {
            const searchText = document.getElementById("searchBar").value.toLowerCase();
            const tasks = getStoredTasks();

            const filtered = tasks.filter(task =>
                task.text.toLowerCase().includes(searchText)
            );

            const list = document.getElementById("todoList");
            list.innerHTML = ""; 

            filtered.forEach(task => displayTask(task));
        }

    </script>

</body>
</html>
